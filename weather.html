<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hong Kong Weather Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #5D5CDE;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .weather-card {
            background: linear-gradient(135deg, rgba(93, 92, 222, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dark .weather-card {
            background: linear-gradient(135deg, rgba(93, 92, 222, 0.2) 0%, rgba(0, 0, 0, 0.1) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 min-h-screen transition-colors duration-300">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-2">
                <i data-lucide="cloud" class="inline-block w-10 h-10 mr-3 text-primary"></i>
                Hong Kong Weather
            </h1>
            <p class="text-gray-600 dark:text-gray-300">Real-time weather information from Hong Kong Observatory</p>
        </div>

        <!-- Loading State -->
        <div id="loading" class="flex justify-center items-center py-20">
            <div class="loading-spinner"></div>
            <span class="ml-3 text-gray-600 dark:text-gray-300">Loading weather data...</span>
        </div>

        <!-- Error State -->
        <div id="error" class="hidden text-center py-20">
            <i data-lucide="alert-circle" class="w-16 h-16 mx-auto text-red-500 mb-4"></i>
            <p class="text-red-600 dark:text-red-400 text-lg">Failed to load weather data. Please try again later</p>
        </div>

        <!-- Main Content -->
        <div id="content" class="hidden">
            <!-- Current Temperature -->
            <div class="weather-card rounded-2xl p-6 mb-6 shadow-lg">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                    <i data-lucide="thermometer" class="w-6 h-6 mr-2 text-primary"></i>
                    Current Temperature
                </h2>
                <div id="temperature" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Temperature data will be populated here -->
                </div>
            </div>

            <!-- Weather Warnings Summary -->
            <div class="weather-card rounded-2xl p-6 mb-6 shadow-lg">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                    <i data-lucide="alert-triangle" class="w-6 h-6 mr-2 text-orange-500"></i>
                    Weather Warnings
                </h2>
                <div id="warnings" class="space-y-3">
                    <!-- Warnings will be populated here -->
                </div>
            </div>

            <!-- Special Weather Tips -->
            <div class="weather-card rounded-2xl p-6 shadow-lg">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                    <i data-lucide="info" class="w-6 h-6 mr-2 text-blue-500"></i>
                    Special Weather Tips
                </h2>
                <div id="special-tips" class="space-y-4">
                    <!-- Special weather tips will be populated here -->
                </div>
            </div>
        </div>

        <!-- Last Updated -->
        <div id="last-updated" class="text-center mt-8 text-sm text-gray-500 dark:text-gray-400 hidden">
            Last updated: <span id="update-time"></span>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Initialize Lucide icons
        lucide.createIcons();

        const API_BASE = 'https://data.weather.gov.hk/weatherAPI/opendata/weather.php';

        async function fetchWeatherData(dataType) {
            try {
                const response = await fetch(`${API_BASE}?dataType=${dataType}&lang=en`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error(`Error fetching ${dataType}:`, error);
                throw error;
            }
        }

        function formatTime(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleString('en-HK', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    timeZone: 'Asia/Hong_Kong'
                });
            } catch (error) {
                return dateString;
            }
        }

        function displayTemperature(data) {
            const temperatureDiv = document.getElementById('temperature');
            
            if (!data.temperature || data.temperature.length === 0) {
                temperatureDiv.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No temperature data available</p>';
                return;
            }

            const temperatureHTML = data.temperature.map(temp => `
                <div class="bg-white dark:bg-gray-700 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-600">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-gray-800 dark:text-white">${temp.place}</h3>
                            <p class="text-2xl font-bold text-primary">${temp.value}Â°${temp.unit}</p>
                        </div>
                        <i data-lucide="thermometer" class="w-8 h-8 text-primary opacity-60"></i>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                        ${formatTime(temp.recordTime)}
                    </p>
                </div>
            `).join('');

            temperatureDiv.innerHTML = temperatureHTML;
            lucide.createIcons();
        }

        function displayWarnings(data) {
            const warningsDiv = document.getElementById('warnings');
            
            if (!data || Object.keys(data).length === 0) {
                warningsDiv.innerHTML = `
                    <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                        <div class="flex items-center">
                            <i data-lucide="check-circle" class="w-5 h-5 text-green-500 mr-3"></i>
                            <p class="text-green-700 dark:text-green-300 font-medium">No active weather warnings</p>
                        </div>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            const warningColors = {
                'Red': 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 text-red-700 dark:text-red-300',
                'Yellow': 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800 text-yellow-700 dark:text-yellow-300',
                'Amber': 'bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800 text-orange-700 dark:text-orange-300',
                'Black': 'bg-gray-50 dark:bg-gray-900/20 border-gray-200 dark:border-gray-800 text-gray-700 dark:text-gray-300',
                'default': 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 text-blue-700 dark:text-blue-300'
            };

            const warningsHTML = Object.values(data).map(warning => {
                const warningType = warning.type || '';
                const colorClass = warningColors[warningType] || warningColors.default;
                
                return `
                    <div class="border rounded-lg p-4 ${colorClass}">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h3 class="font-semibold mb-1">${warning.name}</h3>
                                ${warning.type ? `<span class="inline-block bg-current text-white text-xs px-2 py-1 rounded mb-2 opacity-80">${warning.type}</span>` : ''}
                                <p class="text-sm opacity-90">Action: ${warning.actionCode}</p>
                            </div>
                            <i data-lucide="alert-triangle" class="w-5 h-5 mt-1 opacity-60"></i>
                        </div>
                        <div class="mt-3 text-xs space-y-1">
                            <p>Issued: ${formatTime(warning.issueTime)}</p>
                            <p>Updated: ${formatTime(warning.updateTime)}</p>
                            ${warning.expireTime ? `<p>Expires: ${formatTime(warning.expireTime)}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            warningsDiv.innerHTML = warningsHTML;
            lucide.createIcons();
        }

        function displaySpecialTips(data) {
            const tipsDiv = document.getElementById('special-tips');
            
            if (!data.swt || data.swt.length === 0) {
                tipsDiv.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No special weather tips available</p>';
                return;
            }

            const tipsHTML = data.swt.map(tip => `
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                    <div class="flex items-start">
                        <i data-lucide="info" class="w-5 h-5 text-blue-500 mr-3 mt-1 flex-shrink-0"></i>
                        <div class="flex-1">
                            <p class="text-blue-700 dark:text-blue-300 leading-relaxed">${tip.desc}</p>
                            <p class="text-xs text-blue-600 dark:text-blue-400 mt-3">
                                Updated: ${formatTime(tip.updateTime)}
                            </p>
                        </div>
                    </div>
                </div>
            `).join('');

            tipsDiv.innerHTML = tipsHTML;
            lucide.createIcons();
        }

        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
            lucide.createIcons();
        }

        function showContent() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('last-updated').classList.remove('hidden');
            document.getElementById('update-time').textContent = new Date().toLocaleString('en-HK', {
                timeZone: 'Asia/Hong_Kong'
            });
            lucide.createIcons();
        }

        async function loadWeatherData() {
            try {
                // Fetch all three data types
                const [currentWeather, warningsSummary, specialTips] = await Promise.all([
                    fetchWeatherData('rhrread'), // Current Weather Report for temperature
                    fetchWeatherData('warnsum'), // Weather Warning Summary
                    fetchWeatherData('swt')      // Special Weather Tips
                ]);

                // Display the data
                displayTemperature(currentWeather);
                displayWarnings(warningsSummary);
                displaySpecialTips(specialTips);

                showContent();
            } catch (error) {
                console.error('Error loading weather data:', error);
                showError();
            }
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadWeatherData);

        // Refresh data every 10 minutes
        setInterval(loadWeatherData, 10 * 60 * 1000);
    </script>
</body>
</html>